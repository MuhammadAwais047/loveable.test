<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuizForge PK</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js'</script>
<style>
  :root{--p:#8b5cf6;--s:#ec4899}.drop{border:4px dashed var(--p);border-radius:2rem;transition:.3s}
  .drop.dragover{background:#8b5cf61a;transform:scale(1.02)}.bar{height:12px;background:linear-gradient(90deg,var(--p),var(--s));border-radius:8px}
  .glass{background:rgba(255,255,255,.08);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2)}
  .section{display:none}.section.active{display:block}.c{background:#10b981!important}.w{background:#ef4444!important}
</style>
</head><body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white min-h-screen">

<button onclick="document.body.classList.toggle('dark')" class="fixed top-4 right-4 z-50 text-3xl bg-white/10 border border-white/20 rounded-full p-4">Moon/Sun</button>

<header class="max-w-6xl mx-auto p-6 flex justify-between">
  <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">QuizForge PK</h1>
  <nav class="flex gap-4">
    <button onclick="s('home')" class="px-6 py-3 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20">Home</button>
    <button onclick="s('upload')" class="px-6 py-3 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20">Upload</button>
    <button onclick="s('play')" class="px-6 py-3 rounded-xl bg-white/10 border border-white/20 hover:bg-white/20">Play</button>
  </nav>
</header>

<main class="max-w-6xl mx-auto p-6 space-y-12">

  <!-- HOME -->
  <section id="home" class="section active text-center">
    <h2 class="text-6xl font-bold mb-6 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Turn Notes into Victory</h2>
    <button onclick="s('upload')" class="px-12 py-6 text-2xl rounded-3xl bg-gradient-to-r from-purple-600 to-pink-600 hover:scale-110 transition font-bold">Upload Notes</button>
    <div class="glass rounded-3xl p-8 mt-12"><h3 class="text-3xl font-bold mb-6">My Decks</h3><div id="decks" class="grid md:grid-cols-3 gap-6"></div></div>
  </section>

  <!-- UPLOAD -->
  <section id="upload" class="section text-center space-y-10">
    <h2 class="text-5xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Upload Notes (Scanned PDFs OK)</h2>
    <div id="drop" class="drop glass p-20 cursor-pointer"><i class="fas fa-brain text-9xl text-purple-400"></i>
      <p class="text-3xl font-bold mt-6">Drop PDF / Photo / TXT</p>
      <input type="file" id="file" accept=".pdf,.jpg,.jpeg,.png,.txt" class="hidden">
    </div>
    <div id="result" class="hidden glass rounded-3xl p-10 space-y-6">
      <div class="flex justify-between"><h3 class="text-2xl font-bold">AI Processing</h3><i id="icon" class="fas fa-cog fa-spin text-4xl text-purple-400"></i></div>
      <div class="w-full bg-white/10 rounded-full h-8 overflow-hidden"><div id="bar" class="bar w-0"></div></div>
      <p id="msg" class="text-xl">Ready</p>
      <textarea id="txt" class="w-full h-80 bg-white/5 border border-white/20 rounded-2xl p-6 text-lg" placeholder="Extracted text..."></textarea>
      <button id="gen" class="px-12 py-5 text-2xl rounded-3xl bg-gradient-to-r from-green-500 to-emerald-600 hover:scale-110 transition font-bold">Generate 25 MCQs (Real AI)</button>
    </div>
  </section>

  <!-- PLAY -->
  <section id="play" class="section">
    <div class="glass rounded-3xl p-12 max-w-4xl mx-auto text-center">
      <h2 id="q" class="text-4xl font-bold mb-10">Loading...</h2>
      <div id="opts" class="space-y-6"></div>
      <div class="mt-12 flex justify-center gap-8">
        <button id="prev" class="px-8 py-4 rounded-2xl bg-white/10 border border-white/30" disabled>Previous</button>
        <button id="next" class="px-12 py-6 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-600 font-bold text-2xl">Next</button>
      </div>
      <div id="end" class="hidden"><h2 class="text-6xl font-bold mt-20">Score: <span id="score">0</span>/<span id="total">0</span></h2>
        <button onclick="s('home')" class="mt-10 px-12 py-6 text-2xl rounded-3xl bg-gradient-to-r from-purple-600 to-pink-600 font-bold">Home</button>
      </div>
    </div>
  </section>

</main>

<script>
  const s = id => document.querySelectorAll('.section').forEach(x=>x.classList.toggle('active',x.id===id));
  let worker, deck = [], i = 0, score = 0;

  // Init OCR
  (async()=>{worker = await Tesseract.createWorker('eng+urd',1,{logger:m=>m.status==='recognizing text'&&(document.getElementById('bar').style.width=m.progress*100+'%',document.getElementById('msg').textContent='Reading: '+Math.round(m.progress*100)+'%')});})();

  // Drop zone
  const drop = document.getElementById('drop');
  drop.onclick = () => document.getElementById('file').click();
  ['dragover','dragenter'].forEach(e=>drop.addEventListener(e,ev=>{ev.preventDefault();drop.classList.add('dragover')}));
  ['dragleave','drop'].forEach(e=>drop.addEventListener(e,()=>drop.classList.remove('dragover')));
  drop.addEventListener('drop',e=>{e.preventDefault();document.getElementById('file').files=e.dataTransfer.files;processFile(e.dataTransfer.files[0])});

  // File processing
  document.getElementById('file').onchange = e => e.target.files[0] && processFile(e.target.files[0]);
  async function processFile(f){
    document.getElementById('result').classList.remove('hidden');
    let text = '';
    if(f.name.endsWith('.txt')) text = await f.text();
    else if(f.type.startsWith('image/')||f.name.endsWith('.pdf')){
      document.getElementById('msg').textContent='Scanning...';
      if(f.name.endsWith('.pdf')){
        const pdf = await pdfjsLib.getDocument(URL.createObjectURL(f)).promise;
        for(let p=1;p<=pdf.numPages;p++){
          const page = await pdf.getPage(p);
          const vp = page.getViewport({scale:2});
          const c = document.createElement('canvas');
          c.width=vp.width;c.height=vp.height;
          await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
          const r = await worker.recognize(c.toDataURL());
          text += r.data.text + '\n\n';
          document.getElementById('bar').style.width = (p/pdf.numPages)*100+'%';
        }
      }else{
        const r = await worker.recognize(f);
        text = r.data.text;
      }
    }
    document.getElementById('txt').value = text||'(No text found)';
    document.getElementById('bar').style.width='100%';
    document.getElementById('msg').textContent='Done! Click Generate';
    document.getElementById('icon').className='fas fa-check text-green-400 text-4xl';
  }

  // Generate MCQs with Groq (real AI)
  document.getElementById('gen').onclick = async () => {
    const text = document.getElementById('txt').value.trim();
    if(!text) return alert('No text!');
    document.getElementById('gen').textContent='Generating...';
    try{
      const res = await fetch('https://api.groq.com/openai/v1/chat/completions',{
        method:'POST',headers:{'Authorization':'Bearer ATATT3xFfGF0wu4gvnItQmACHcrkHYIydjpu2zgpSpDKFiz9M0_g5yvR2UPIkOXGSNPwrbLlDWeTDtJOId8X1DjzBRr_1aZ5mDK33MrFVZ74NL62HbevoTrlk0sp-VZf_7rjO2BgY73FAYcqHePtCrl2GWdp30XP09SbN49OFecWxoemghDOugo=4EDA7841','Content-Type':'application/json'},
        body:JSON.stringify({model:"llama3-70b-8192",messages:[{role:"user",content:`Generate 25 high-quality MCQs (4 options) from this text. Return ONLY valid JSON array with: question, options[], correctIndex (0-3), explanation\n\nText: ${text.slice(0,12000)}`}]})
      });
      const data = await res.json();
      deck = JSON.parse(data.choices[0].message.content);
    }catch{deck = text.split('\n\n').filter(p=>p.length>50).slice(0,15).map((p,j)=>({question:p.split('.')[0]+'?',options:['A','B','C','D'],correctIndex:1,explanation:'Fallback'}));}
    localStorage.setItem('deck_'+Date.now(),JSON.stringify(deck));
    loadDecks(); s('play'); startQuiz();
  };

  // Quiz
  function startQuiz(){i=0;score=0;showQ();}
  function showQ(){
    if(i>=deck.length){document.getElementById('end').classList.remove('hidden');document.getElementById('score').textContent=score;document.getElementById('total').textContent=deck.length;return;}
    const q = deck[i];
    document.getElementById('q').textContent = `Q${i+1}: ${q.question}`;
    document.getElementById('opts').innerHTML = q.options.map((o,j)=>`<button onclick="ans(${j},${q.correctIndex})" class="w-full p-8 text-2xl rounded-3xl border-4 border-white/20 hover:border-purple-400 hover:bg-white/10 transition">${String.fromCharCode(65+j)}) ${o}</button>`).join('');
    document.getElementById('prev').disabled=i===0;
    document.getElementById('end').classList.add('hidden');
  }
  window.ans = (sel,cor)=>{if(sel===cor)score++;i++;setTimeout(showQ,700);}
  document.getElementById('next').onclick = ()=>{i++;showQ();}
  document.getElementById('prev').onclick = ()=>{i--;showQ();}

  // Load saved decks
  function loadDecks(){
    const c = document.getElementById('decks');
    const keys = Object.keys(localStorage).filter(k=>k.startsWith('deck_')).sort().reverse();
    c.innerHTML = keys.length?keys.map(k=>`<div onclick="deck=JSON.parse(localStorage['${k}']);s('play');startQuiz()" class="glass rounded-3xl p-8 cursor-pointer hover-lift"><h3 class="text-2xl font-bold text-purple-300">${new Date(+k.split('_')[1]).toLocaleDateString()}</h3><p>${JSON.parse(localStorage[k]).length} Questions</p></div>`).join(''):'<p class="text-center text-xl text-white/60">No decks yet</p>';
  }
  loadDecks();
</script>
</body></html>
